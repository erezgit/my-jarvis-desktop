# My Jarvis Desktop v1.25.0 - Multi-User Workspace Support

## Overview
Fixed the hardcoded workspace path issue that prevented the app from working on other users' computers. The app now dynamically detects the user's home directory and allows users to select their own workspace folder.

## Problem
The app was hardcoded to use `/Users/erezfern/Workspace/my-jarvis` as the workspace directory, causing:
- Stream errors and agent not responding on other users' computers
- File tree trying to load non-existent directories
- App failing to function properly on Lillach's computer

## Solution

### 1. Dynamic Home Directory Detection
**File**: `app/types/settings.ts`
- Created `getDefaultWorkspace()` function that uses Node.js `os.homedir()` API
- Default workspace now set to `~/Documents/MyJarvis` for each user
- Falls back gracefully if Electron API not available

### 2. Removed Hardcoded Workspace List
**File**: `app/components/settings/GeneralSettings.tsx`
- Removed hardcoded array of workspace paths
- Replaced with dynamic workspace selector using native Electron dialog
- Users can now browse and select any directory as their workspace

### 3. Native File Dialog Integration
**New File**: `lib/main/dialog-handler.ts`
- Registered IPC handler for `dialog:select-directory`
- Uses Electron's native `showOpenDialog` with directory selection
- Integrated with main process handlers in `lib/main/main.ts`

### 4. Preload Security Layer
**File**: `lib/preload/preload.ts`
- Exposed whitelisted IPC channel `dialog:select-directory` to renderer
- Maintained security by only allowing specific dialog operations
- Added to existing `electronAPI` context bridge

### 5. Storage Migration
**File**: `app/utils/storage.ts`
- Updated `migrateLegacySettings()` to use dynamic home directory
- Ensures existing users get correct default workspace on first launch
- Handles cases where Electron API might not be available

## User Experience

### First Launch
1. App opens with default workspace: `~/Documents/MyJarvis`
2. User can immediately start using the app
3. No manual configuration required

### Changing Workspace
1. Open Settings → Workspace Directory section
2. Click "Change Workspace" button
3. Native macOS file picker opens
4. Select any directory
5. App reloads with new workspace

## Technical Details

### Files Changed
- `app/types/settings.ts` - Dynamic default workspace
- `app/components/settings/GeneralSettings.tsx` - File picker UI
- `lib/main/dialog-handler.ts` - IPC dialog handler (NEW)
- `lib/main/main.ts` - Register dialog handlers
- `lib/preload/preload.ts` - Expose dialog API
- `app/utils/storage.ts` - Migration with dynamic paths
- `package.json` - Version bump to 1.25.0

### Architecture
```
User clicks "Change Workspace"
    ↓
GeneralSettings.tsx calls electronAPI.ipcRenderer.invoke('dialog:select-directory')
    ↓
Preload validates whitelisted channel
    ↓
Main process dialog-handler.ts shows native dialog
    ↓
User selects directory
    ↓
Path returned to renderer
    ↓
Settings context updates workingDirectory
    ↓
Persists to localStorage
    ↓
Chat reloads with new workspace
```

## Installation for Lillach

### Prerequisites (Already Completed)
✅ Node.js v22.20.0 installed via Homebrew
✅ Claude CLI installed globally: `sudo npm install -g @anthropic-ai/claude-code`
✅ Claude CLI authenticated: `claude login`

### Install v1.25.0
1. Copy DMG file to Lillach's computer:
   ```
   spaces/my-jarvis-desktop/projects/my-jarvis-desktop/dist/my-jarvis-desktop-1.25.0.dmg
   ```

2. Install:
   - Open DMG file
   - Right-click on MyJarvisDesktop.app → Open (bypass security)
   - Confirm opening from unidentified developer

3. First Launch:
   - App will automatically use `~/Documents/MyJarvis` as workspace
   - If directory doesn't exist, user can create it via Settings
   - Or select existing directory with project files

### Expected Behavior
- App launches successfully
- No hardcoded path errors
- Agent responds to chat messages
- File tree loads from user's workspace directory
- Stream processing works correctly

## Testing

### On Developer Machine (erezfern)
- ✅ App loads with existing workspace
- ✅ Settings show current workspace path
- ✅ Can change workspace via file picker
- ✅ Workspace persists across restarts

### On Lillach's Machine
- Test default workspace creation
- Test workspace selection
- Test chat functionality with new workspace
- Test file tree loading
- Test stream processing

## Version History
- **v1.20.0** - Original build with hardcoded paths
- **v1.21.0** - Attempted bundling Node.js/CLI (wrong approach)
- **v1.22.0** - PKG installer with post-install script (failed)
- **v1.23.0** - Reverted to clean DMG
- **v1.24.0** - Fixed PATH issue
- **v1.25.0** - **Multi-user workspace support with dynamic paths** ✅

## Next Steps
1. Install v1.25.0 on Lillach's computer
2. Verify workspace detection works
3. Test chat/agent functionality
4. Confirm no stream errors
5. Document any remaining issues

## Migration Notes
- Existing users with localStorage settings will be migrated automatically
- Old hardcoded path will be replaced with dynamic home directory path
- No manual intervention required
- Settings version remains at 4 (no breaking changes)

## Security Considerations
- IPC channels are whitelisted in preload for security
- Only `dialog:select-directory` channel exposed to renderer
- Native Electron dialog used (no shell injection risks)
- Selected paths validated by Electron
- Workspace paths stored in localStorage (user-specific)
